<p-progressBar
*ngIf="isLoading$ | async"
mode="indeterminate"
[style]="{ height: '4px' }"
/>

<ng-container *ngIf="!(isLoading$ | async)">
<div id="kt_app_toolbar" class="app-toolbar pt-10 px-10 pb-0 mb-0">
  <div id="kt_app_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
    <div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
      <div class="page-title d-flex flex-column justify-content-center gap-1 me-3">
        <h1 class="page-heading d-flex flex-column justify-content-center text-gray-900 fw-bold fs-3 m-0">
          Regions
        </h1>
        <div class="fw-semibold fs-7 my-0 text-muted">{{listOfRegions.length}} Regions</div>
      </div>
      <div class="d-flex align-items-center gap-3">
        <div class="d-flex align-items-center position-relative">
          <i class="pi pi-search position-absolute ms-3" style="font-size: 14px; color: #6c757d;"></i>
          <input
              type="text"
              pInputText
              class="form-control ps-10"
              style="width: 240px; height: 36px; border: 1px solid #cbd5e1; border-radius: 6px;"
              placeholder="Search"
              (input)="applyFilter($event)"
          />
        </div>
        <button 
          (click)="showDialog()" 
          class="btn btn-sm d-flex align-items-center "
          style="background: white; border: 1px solid #cbd5e1; border-radius: 6px; padding: 6px 12px; height: 36px; white-space: nowrap;"
        >
          <i class="ki-outline ki-plus fs-5" style="color: #3b82f6;"></i>
          <span class="ms-1" style="font-size: 13px; font-weight: 500; color: #374151;">Create</span>
        </button>
      </div>

    
    </div>
  </div>
</div>

<p-dialog appendTo="body" [header]="isEditMode ? 'Edit Region' : 'Add Region'" [modal]="true" [(visible)]="visible" [style]="{ width: '40rem' }">
            <p-messages *ngIf="hasErrorMessage" [(value)]="messages" [enableService]="false"></p-messages>
            <span class="text-muted mb-3 d-block">{{ isEditMode ? 'Edit Region Details' : 'Add Region Details' }}.</span>

            <form [formGroup]="regionForm">
              <div class="mb-3 row">
                <label for="regionEn" class="col-sm-3 col-form-label">Name (English)</label>
                <div class="col-sm-9">
                  <input pInputText id="regionEn" class="form-control" formControlName="regionEn" autocomplete="off" />
                  <div *ngIf="regionEn?.invalid && (regionEn?.dirty || regionEn?.touched)">
                    <div *ngIf="regionEn?.errors?.required" class="text-danger">
                      English Name is required.
                    </div>
                    <div *ngIf="regionEn?.errors?.serverError" class="text-danger">
                      {{ regionEn?.errors?.serverError }}
                    </div>
                  </div>
                </div>
              </div>

              <div class="mb-3 row">
                <label for="regionAr" class="col-sm-3 col-form-label">Name (Arabic)</label>
                <div class="col-sm-9">
                  <input pInputText id="regionAr" class="form-control" formControlName="regionAr" autocomplete="off" />
                  <div *ngIf="regionAr?.invalid && (regionAr?.dirty || regionAr?.touched)">
                    <div *ngIf="regionAr?.errors?.required" class="text-danger">
                      Arabic Name is required.
                    </div>
                    <div *ngIf="regionAr?.errors?.serverError" class="text-danger">
                      {{ regionAr?.errors?.serverError }}
                    </div>
                  </div>
                </div>
              </div>
            </form>

            <div class="d-flex justify-content-end gap-2">
              <button
                type="submit"
                [disabled]="regionForm.invalid || (isLoading$ | async)" (click)="submit()" class="btn btn-primary btn-sm"
              >
                <ng-container *ngIf="(isLoading$ | async) === false">
                  <span class="indicator-label">Save</span>
                </ng-container>
                <ng-container *ngIf="isLoading$ | async">
                  <span class="indicator-progress" [style.display]="'block'">
                    Please wait
                    <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                  </span>
                </ng-container>
              </button>
              <button (click)="onCancel()" class="btn btn-outline-secondary btn-sm">
                Cancel
              </button>
            </div>
          </p-dialog>

<div id="kt_app_content" class="app-content px-10 pb-10 pt-5 flex-column-fluid">
  <div id="kt_app_content_container" class="app-container container-fluid">
    <p-messages *ngIf="hasSuccessMessage" [(value)]="messages" [enableService]="false"></p-messages>
    
    <ng-container *ngIf="(isLoading$ | async) === false && listOfRegions.length > 0">
      <p-table
        #dt
        [value]="listOfRegions"
        [paginator]="true"
        [rows]="10"
        [loading]="isLoading$ | async"
        [globalFilterFields]="['name', 'names.en', 'names.ar']"
        responsiveLayout="scroll"
        [rowHover]="true"
        [tableStyle]="{'width': '100%'}"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 35%">Name (English)</th>
            <th style="width: 35%">Name (Arabic)</th>
            <th style="width: 30%"></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-region>
          <tr>
            <td>
              <span class="text-gray-800 fw-semibold">{{ region.names.en }}</span>
            </td>
            <td>
              <span class="text-gray-700">{{ region.names.ar }}</span>
            </td>
            <td>
              <div class="d-flex justify-content-end gap-1">
                <button 
                    pButton
                    icon="pi pi-pencil"
                    class="p-button-rounded p-button-text p-button-sm"
                    style="width: 28px; height: 28px; background: #3b82f6; color: white; border-radius: 6px;"
                    (click)="editRegion(region)"
                    pTooltip="Edit"
                    tooltipPosition="top">
                </button>
                <button 
                    pButton
                    icon="pi pi-trash"
                    class="p-button-rounded p-button-text p-button-sm"
                    style="width: 28px; height: 28px; background: #ef4444; color: white; border-radius: 6px;"
                    (click)="deleteRegion(region.id)"
                    pTooltip="Delete"
                    tooltipPosition="top">
                </button>
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="3">
              <div class="d-flex flex-column align-items-center justify-content-center py-8">
                <i class="pi pi-inbox text-gray-400 mb-2" style="font-size: 48px;"></i>
                <div class="text-gray-600 fw-semibold">No regions found</div>
                <div class="text-gray-500" style="font-size: 14px;">No regions match your search criteria.</div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </ng-container>

    <ng-container *ngIf="(isLoading$ | async) === false && listOfRegions.length === 0">
        <div class="d-flex flex-column align-items-center justify-content-center py-8">
            <i class="pi pi-inbox text-gray-400 mb-2" style="font-size: 48px;"></i>
            <div class="text-gray-600 fw-semibold">No regions available</div>
            <div class="text-gray-500" style="font-size: 14px;">No regions have been created yet.</div>
        </div>
    </ng-container>
  </div>
</div>
</ng-container>
  