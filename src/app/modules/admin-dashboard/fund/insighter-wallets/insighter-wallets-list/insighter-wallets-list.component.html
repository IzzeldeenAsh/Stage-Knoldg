<div class="d-flex flex-column">


  <!-- Loading Indicator -->
  <div *ngIf="isLoading$ | async" class="d-flex justify-content-center align-items-center" style="min-height: 300px;">
    <div class="spinner-border text-info" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Wallets Table -->
  <div *ngIf="!(isLoading$ | async)" class="card">
    <div class="card-header border-0 pt-5">
      <h3 class="card-title align-items-start flex-column">
        <span class="card-label fw-bold fs-3 mb-1">Insighter Wallets</span>
        <span class="text-muted mt-1 fw-semibold fs-7">Total: {{ totalItems }} insighters</span>
      </h3>

      <!-- Filters -->
      <div class="card-toolbar">
        <div class="d-flex align-items-center gap-4">
          <!-- Balance Status Filter -->
          <div class="d-flex align-items-center">
            <label class="form-label fw-semibold text-gray-600 fs-7 me-2 mb-0">Balance Status:</label>
            <select
              class="form-select form-select-sm w-auto"
              [(ngModel)]="balanceStatus"
              (change)="onBalanceStatusChange($event)">
              <option *ngFor="let option of balanceStatusOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>

          <!-- Overdue Wired Transaction Filter -->
          <div class="form-check form-check-sm">
            <input
              class="form-check-input"
              type="checkbox"
              id="overdueFilter"
              [checked]="overdueWiredTransaction === 1"
              (change)="onOverdueFilterChange($event)">
            <label class="form-check-label fw-semibold text-gray-600 fs-7" for="overdueFilter">
              Overdue Wired (+60 days)
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="card-body py-3">
      <div class="table-responsive">
        <table class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4">
          <thead>
            <tr class="fw-bold text-muted">
              <th class="min-w-150px">Insighter</th>
              <th class="min-w-100px">Location</th>
              <th class="min-w-120px">Balance</th>
              <th class="min-w-100px">Payment Type</th>
              <th class="min-w-110px">Last Wired Transfer</th>
              <th class="min-w-160px">Transfer Form</th>
              <th class="min-w-70px text-end">Transactions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let wallet of wallets">
              <!-- Insighter Info -->
              <td>
                <div class="d-flex align-items-center">
                  <div class="symbol symbol-45px me-5 ">
                    <img *ngIf="wallet.profile_photo_url" [src]="wallet.profile_photo_url" alt="" style="object-fit: cover; object-position: top;"/>
                    <div *ngIf="!wallet.profile_photo_url" class="symbol-label bg-light-info text-info fw-bold">
                      {{ wallet.name.charAt(0) }}
                    </div>
                  </div>
                  <div class="d-flex justify-content-start flex-column">
                    <a href="javascript:void(0)" class="text-dark fw-bold text-hover-primary fs-6">{{ wallet.name }}</a>
                    <span *ngIf="wallet.company" class="text-muted fw-semibold text-muted d-block fs-7">
                      <span class="badge badge-light-info">{{ wallet.company.legal_name }}</span>
                      <i *ngIf="wallet.company.verified" class="ki-outline ki-verify fs-7 text-success ms-1"></i>
                    </span>
                  </div>
                </div>
              </td>

           

              <!-- Location -->
              <td>
                <span class="text-dark fw-semibold fs-6">{{ wallet.country }}</span>
              </td>

              <!-- Balance -->
              <td>
                <div class="d-flex align-items-center">
                  <span class="text-dark fw-bold fs-6">${{ wallet.balance }}</span>
               
                </div>
              </td>

              <!-- Payment Type -->
              <td>
                <span class="badge badge-light-info text-capitalize">{{ wallet.payment_type }}</span>
              </td>

              <!-- Last Wired Transfer -->
              <td>
                <span *ngIf="wallet.last_wired_transfer" class="text-dark fw-semibold fs-6">
                  {{ wallet.last_wired_transfer | date:'mediumDate' }}
                </span>
                <span *ngIf="!wallet.last_wired_transfer" class="text-muted fw-semibold fs-6">
                  N/A
                </span>

              <!-- Form -->
              <td>
                <button
                  class="btn btn-sm btn-light-info"
                  (click)="viewForm(wallet.id)">
                  <i class="ki-outline ki-document fs-4 me-1"></i>
                  View Form
                </button>
              </td>


              <!-- Actions -->
              <td class="text-end">
                <button
                  class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1"
                  (click)="viewTransactions(wallet.id)"
                  [title]="'View Transactions'">
                  <i class="ki-outline ki-eye fs-2"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div *ngIf="totalPages > 1" class="d-flex flex-stack flex-wrap pt-10">
        <div class="fs-6 fw-semibold text-gray-700">
          Showing {{ (currentPage - 1) * 10 + 1 }} to {{ Math.min(currentPage * 10, totalItems) }} of {{ totalItems }} entries
        </div>

        <ul class="pagination">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="currentPage > 1 && onPageChange(currentPage - 1)">
              <i class="previous"></i>
            </a>
          </li>

          <li *ngFor="let page of [].constructor(totalPages); let i = index"
              class="page-item"
              [class.active]="currentPage === i + 1">
            <a class="page-link" (click)="onPageChange(i + 1)">{{ i + 1 }}</a>
          </li>

          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="currentPage < totalPages && onPageChange(currentPage + 1)">
              <i class="next"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!(isLoading$ | async) && wallets.length === 0" class="card">
    <div class="card-body text-center py-15">
      <div class="text-center">
        <i class="ki-outline ki-wallet fs-4x text-muted mb-5"></i>
        <h3 class="text-gray-800 fs-2 fw-bold mb-3">No Wallets Found</h3>
        <p class="text-gray-500 fs-6 fw-semibold mb-0">
          There are no insighter wallets to display at the moment.
        </p>
      </div>
    </div>
  </div>
</div>