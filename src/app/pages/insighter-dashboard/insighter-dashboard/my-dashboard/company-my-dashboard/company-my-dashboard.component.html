<div *ngIf="needsAgreement" class="alert alert-warning d-flex align-items-center justify-content-between" role="alert" style="border: 1px solid #ffeeba;">
  <div class="d-flex align-items-center">
    <i class="ki-duotone ki-information-2 fs-2 text-warning me-3"></i>
    <span class="fw-semibold">{{lang === 'ar' ? 'لم تقبل الاتفاقية الأخيرة' : 'You have not accepted the latest agreement.'}}</span>
  </div>
  <button class="btn btn-sm btn-warning fw-semibold" (click)="openAgreementModal()">{{lang === 'ar' ? 'مراجعة وموافقة' : 'Review & Accept'}}</button>
</div>
<app-agreement-modal
  [(visible)]="showAgreementModal"
  [agreementType]="'company_agreement'"
  (accepted)="onAgreementAccepted()"

  (cancelled)="onAgreementCancelled()"
></app-agreement-modal>
<app-widgets-row [userRole]="userRole"></app-widgets-row>
<div class="row g-4">
    <div class="col-12 col-lg-4 d-flex">
      <div class="card border-0 h-100 w-100">
        <div class="card-body chart-card text-center p-4">
          <div class="chart-card__header">
            <h6 class="card-title fw-bold text-gray-800 mb-0">{{ 'PUBLISHED_KNOWLEDGE_DASHBOARD' | translate }}</h6>
          </div>
          <ng-container *ngIf="publishedKnowledgeChartData; else publishedKnowledgeEmpty">
            <div class="donut-wrapper">
              <p-chart
                type="doughnut"
                [data]="publishedKnowledgeChartData"
                [options]="publishedKnowledgeChartOptions"
                width="180"
                height="180">
              </p-chart>
              <div class="donut-wrapper__center">
                <div class="donut-wrapper__total">{{ totalPublishedKnowledge }}</div>
                <div class="donut-wrapper__label">{{ 'TOTAL_DASHBOARD' | translate }}</div>
              </div>
            </div>
            <div *ngIf="publishedKnowledgeLegend.length" class="chart-legend mt-4">
              <div *ngFor="let legendItem of publishedKnowledgeLegend" class="chart-legend__item">
                <span class="chart-legend__swatch" [style.backgroundColor]="legendItem.color"></span>
                <span class="chart-legend__label">{{ legendItem.labelKey | translate }}</span>
              </div>
            </div>
          </ng-container>
          <ng-template #publishedKnowledgeEmpty>
            <div class="chart-card__empty">
              <i class="ki-duotone ki-file fs-2x text-muted mb-2"></i>
              <div class="text-muted fs-7">No data available</div>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  <div class="col-12 col-lg-4 d-flex">
    <div
      class="card card-xl-stretch border-0 h-100 w-100"
      [ngClass]="{ 'rtl-bg-flip': lang === 'ar' }"
      [ngStyle]="{
                  'background-image': 'url(./assets/media/illustrations/misc/bg-publish.png)',
                  'background-size': 'cover',
                  'background-repeat': 'no-repeat',
                  'background-position':'100%',
                  'border-radius': '10px',
                }"
    >
      <!--begin::Body-->
      <div class="card-body d-flex flex-column flex-wrap p-8">
        <div class="d-flex flex-column align-items-start">
          <h1 class="fs-2x fw-bolder text-gray-800 pb-3 m-0 p-0">
            {{ "START_UPLOADING" | translate }}
          </h1>
          <p
            class="text-start text-gray-800 pb-4 fw-semibold fs-5"
            [innerHTML]="'START_UPLOADING_DESRIPTION' | translate"
            [ngClass]="{ 'force-text-align-right': isArabicAndNotRtl }"
          ></p>
        </div>
        <div>
          <a
            [routerLink]="['/app/insighter-dashboard/my-knowledge/general']"
            class="btn btn-info fw-semibold px-6 py-3"
            data-bs-toggle="modal"
            data-bs-target="#kt_modal_create_campaign"
          >
            {{ "MENU.MY_LIBRARY" | translate }}
          </a>
        </div>
      </div>
      <!--end::Body-->
    </div>
  </div>
    <div class="col-12 col-lg-4 d-flex">
      <div
        class="card card-xl-stretch border-0 h-100 w-100"
      [ngClass]="{ 'rtl-bg-flip': lang === 'ar' }"
      [ngStyle]="{
                  'background-image': 'url(./assets/media/illustrations/misc/build-team.png)',
                  'background-size': 'cover',
                  'background-repeat': 'no-repeat',
                  'background-position':'100%',
                  'border-radius': '10px',
                }"
      >
        <!--begin::Body-->
        <div class="card-body d-flex flex-column flex-wrap p-8">
          <div class="d-flex flex-column align-items-start">
            <h1 class="fs-2x fw-bolder text-gray-800 pb-3 m-0 p-0">
              {{ "BUILD_YOUR_TEAM" | translate }}
            </h1>
            <p
              class="text-start text-gray-800 pb-4 fw-semibold fs-5"
              [innerHTML]="'BUILD_YOUR_TEAM_DESCRIPTION' | translate"
              [ngClass]="{ 'force-text-align-right': isArabicAndNotRtl }"
            ></p>
          </div>
          <div>
            <a
              [routerLink]="['/app/insighter-dashboard/my-company-settings']"
              [queryParams]="{ addEmployee: 'true' }"
              class="btn btn-info fw-semibold px-6 py-3"
            >
              {{ "MY_COMPANY.ADD_EMPLOYEE" | translate }}
            </a>
          </div>
        </div>
        <!--end::Body-->
      </div>
    </div>
</div>

<div class="row mt-6" *ngIf="showNotificationPreferencesBanner">
  <div class="col-12">
    <div
      class="card border-0 overflow-hidden px-10"
      style="background: linear-gradient(135deg, #fff 0%, #cdffdd 100%);"
    >
      <div
        class="card-body d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-6 p-6 p-md-8"
      >
        <div [ngClass]="{ 'text-end': lang === 'ar' }">
          <div class="fw-bold fs-2 text-gray-800 mb-2">
            {{ lang === 'ar' ? 'إشعارات واتساب والرسائل النصية' : 'WhatsApp & SMS notifications' }}
          </div>
          <div class="text-gray-600 fw-semibold fs-5" style="max-width: 400px;">
            {{
              lang === 'ar'
                ? 'هل تريد استلام الإشعارات عبر واتساب والرسائل النصية؟ أضف أرقامك واختر لغة التواصل من الإعدادات الشخصية.'
                : 'Want to receive notifications by WhatsApp and SMS? Add your numbers and choose your preferred language in Personal settings.'
            }}
          </div>
          <div class="mt-5">
            <button type="button" class="btn btn-sm btn-primary fw-semibold" (click)="goToNotificationPreferences()">
              {{ lang === 'ar' ? 'تحديث التفضيلات' : 'Update preferences' }}
            </button>
          </div>
        </div>

        <img
          class="d-none d-md-block"
          [src]="notificationBannerImageUrl"
          [alt]="lang === 'ar' ? 'واتساب والرسائل النصية' : 'WhatsApp and SMS'"
          style="width: 200px; height: 200px; object-fit: contain;"
          loading="lazy"
        />
      </div>
    </div>
  </div>
</div>
