<div class="card mb-5 mb-xl-10 shadow-none border-1 border border-gray-300 rounded-2">
  <div class="card-header border-0 cursor-pointer" role="button">
    <div class="card-title m-0">
      <h3 class="fw-bold m-0">{{ 'ACCOUNT_SETTINGS.SET_PASSWORD' | translate }}</h3>
    </div>
  </div>

  <div>
    <div class="card-body border-top p-9">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-10">
        <div *ngIf="!isEditing()">
          <div class="fs-6 fw-bold mb-1">{{ 'ACCOUNT_SETTINGS.PASSWORD' | translate }}</div>
          <div class="fw-semibold text-gray-600">
            {{ 'ACCOUNT_SETTINGS.NO_PASSWORD_SET' | translate }}
          </div>
        </div>

        <div class="flex-row-fluid" *ngIf="isEditing()">
          <div class="mb-5 text-gray-600">
            {{ 'ACCOUNT_SETTINGS.SET_PASSWORD_CODE_HINT' | translate }}
          </div>

          <form (ngSubmit)="submitSetPassword(setPasswordForm)" #setPasswordForm="ngForm">
            <div class="row mb-3">
              <div class="col-lg-4">
                <div class="fv-row mb-0">
                  <label for="newpassword_set" class="form-label fs-6 fw-bold mb-3">
                    {{ 'ACCOUNT_SETTINGS.NEW_PASSWORD' | translate }}
                  </label>
                  <div class="position-relative">
                    <input
                      [type]="showPassword() ? 'text' : 'password'"
                      pInputText
                      class="form-control form-control-lg form-control-solid"
                      id="newpassword_set"
                      [(ngModel)]="password"
                      name="newpassword_set"
                      required
                      minlength="8"
                      #newPasswordModel="ngModel"
                    />
                    <i
                      class="position-absolute top-50 translate-middle-y cursor-pointer"
                      [ngClass]="{
                        'bi bi-eye-slash': showPassword(),
                        'bi bi-eye': !showPassword(),
                        'end-0 pe-3': !isRtl(),
                        'start-0 ps-3': isRtl()
                      }"
                      (click)="togglePasswordVisibility()"
                    ></i>
                  </div>
                  <div
                    class="text-danger mt-2"
                    *ngIf="
                      newPasswordModel.errors?.['minlength'] &&
                      (newPasswordModel.touched || newPasswordModel.dirty || setPasswordForm.submitted)
                    "
                  >
                    {{ 'ACCOUNT_SETTINGS.PASSWORD_RULES' | translate }}
                  </div>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="fv-row mb-0">
                  <label for="confirmpassword_set" class="form-label fs-6 fw-bold mb-3">
                    {{ 'ACCOUNT_SETTINGS.CONFIRM_NEW_PASSWORD' | translate }}
                  </label>
                  <div class="position-relative">
                    <input
                      [type]="showConfirmPassword() ? 'text' : 'password'"
                      pInputText
                      class="form-control form-control-lg form-control-solid"
                      id="confirmpassword_set"
                      [(ngModel)]="confirmPassword"
                      name="confirmpassword_set"
                      required
                      minlength="8"
                      #confirmPasswordModel="ngModel"
                    />
                    <i
                      class="position-absolute top-50 translate-middle-y cursor-pointer"
                      [ngClass]="{
                        'bi bi-eye-slash': showConfirmPassword(),
                        'bi bi-eye': !showConfirmPassword(),
                        'end-0 pe-3': !isRtl(),
                        'start-0 ps-3': isRtl()
                      }"
                      (click)="toggleConfirmPasswordVisibility()"
                    ></i>
                  </div>
                </div>
                <div
                  class="text-danger mt-2"
                  *ngIf="
                    confirmPasswordModel.errors?.['minlength'] &&
                    (confirmPasswordModel.touched || confirmPasswordModel.dirty || setPasswordForm.submitted)
                  "
                >
                  {{ 'ACCOUNT_SETTINGS.PASSWORD_RULES' | translate }}
                </div>
                <div
                  class="text-danger mt-2"
                  *ngIf="
                    !passwordsMatch() &&
                    (confirmPasswordModel.touched || confirmPasswordModel.dirty || setPasswordForm.submitted)
                  "
                >
                  {{ 'ACCOUNT_SETTINGS.PASSWORDS_DO_NOT_MATCH' | translate }}
                </div>
              </div>

              <div class="col-lg-4">
                <div class="fv-row mb-0">
                  <label for="code_set" class="form-label fs-6 fw-bold mb-3">
                    {{ 'ACCOUNT_SETTINGS.EMAIL_CODE' | translate }}
                  </label>
                  <input
                    type="text"
                    inputmode="numeric"
                    pInputText
                    class="form-control form-control-lg form-control-solid"
                    id="code_set"
                    [(ngModel)]="code"
                    name="code_set"
                    required
                  />

                  <div class="d-flex align-items-center gap-3 mt-3">
                    <button
                      type="button"
                      class="btn btn-light btn-sm btn-active-light-primary"
                      (click)="sendCode()"
                      [disabled]="isSendingCode() || resendCooldown() > 0"
                    >
                      <ng-container *ngIf="resendCooldown() === 0">
                        <ng-container *ngIf="codeSent()">
                          {{ 'ACCOUNT_SETTINGS.RESEND_CODE' | translate }}
                        </ng-container>
                        <ng-container *ngIf="!codeSent()">
                          {{ 'ACCOUNT_SETTINGS.SEND_CODE' | translate }}
                        </ng-container>
                      </ng-container>
                      <ng-container *ngIf="resendCooldown() > 0">
                        {{ 'ACCOUNT_SETTINGS.RESEND_IN' | translate }} {{ resendCooldown() }}s
                      </ng-container>
                    </button>
                    <span class="text-gray-600" *ngIf="codeSent()">
                      {{ 'ACCOUNT_SETTINGS.CODE_SENT' | translate }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-text mb-5">
              {{ 'ACCOUNT_SETTINGS.PASSWORD_RULES' | translate }}
            </div>

            <div class="d-flex">
              <button
                type="submit"
                class="btn btn-primary me-2 px-6"
                [disabled]="!passwordsMatch() || setPasswordForm.invalid || isSubmitting()"
              >
                <ng-container *ngIf="!isSubmitting()">
                  {{ 'ACCOUNT_SETTINGS.SET_PASSWORD_ACTION' | translate }}
                </ng-container>
                <ng-container *ngIf="isSubmitting()">
                  {{ 'COMMON.PLEASE_WAIT' | translate }}
                </ng-container>
              </button>

              <button
                type="button"
                class="btn btn-color-gray-500 btn-active-light-primary px-6"
                (click)="cancelEdit()"
                [disabled]="isSubmitting()"
              >
                {{ 'ACCOUNT_SETTINGS.CANCEL' | translate }}
              </button>
            </div>
          </form>
        </div>

        <div *ngIf="!isEditing()">
          <button class="btn btn-light btn-sm btn-active-light-primary" (click)="beginSetPassword()">
            {{ 'ACCOUNT_SETTINGS.SET_PASSWORD_ACTION' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

