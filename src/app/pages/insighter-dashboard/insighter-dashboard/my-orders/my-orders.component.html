
<!-- Page Header with Tabs -->
<app-page-header
  [titleEn]="'My Orders'"
  [titleAr]="'طلباتي'"
  [lang]="currentLang"
  [subtitle]="getOrdersSubtitle()"
  [showTabs]="true">

  <!-- Icon slot -->
  <i slot="icon">
<svg width="33" height="35" viewBox="0 0 33 35" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1.82422 10.2922H7.03809C7.86907 10.2923 8.54567 10.9691 8.5459 11.8V33.175C8.54581 34.0061 7.86916 34.6828 7.03809 34.6829H1.82422C0.993258 34.6826 0.316491 34.006 0.316406 33.175V11.8C0.316638 10.9692 0.993348 10.2925 1.82422 10.2922Z" fill="#3799FF" stroke="#3799FF" stroke-width="0.633563"/>
<path d="M4.43125 28.7438C3.99959 28.7438 3.64926 28.3935 3.64926 27.9618V13.886C3.64926 13.4543 3.99959 13.104 4.43125 13.104C4.86291 13.104 5.21324 13.4543 5.21324 13.886V27.9618C5.21324 28.3935 4.86291 28.7438 4.43125 28.7438Z" fill="white"/>
<path d="M3.6496 30.625H5.21307C5.46978 30.625 5.67889 30.8341 5.67889 31.0908C5.67877 31.3474 5.4697 31.5557 5.21307 31.5557H3.6496C3.39297 31.5557 3.1839 31.3474 3.18378 31.0908C3.18378 30.8341 3.39289 30.625 3.6496 30.625Z" fill="#3799FF" stroke="#3799FF" stroke-width="0.633563"/>
<path d="M10.6561 10.2922H15.87C16.701 10.2923 17.3775 10.9691 17.3778 11.8V33.175C17.3777 34.0061 16.701 34.6828 15.87 34.6829H10.6561C9.82514 34.6826 9.14837 34.006 9.14828 33.175V11.8C9.14852 10.9692 9.82523 10.2925 10.6561 10.2922Z" fill="#37AFFF" stroke="#37AFFF" stroke-width="0.633563"/>
<path d="M13.2632 28.7438C12.8315 28.7438 12.4812 28.3935 12.4812 27.9618V13.886C12.4812 13.4543 12.8315 13.104 13.2632 13.104C13.6949 13.104 14.0452 13.4543 14.0452 13.886V27.9618C14.0452 28.3935 13.6949 28.7438 13.2632 28.7438Z" fill="white"/>
<path d="M12.4814 30.625H14.0449C14.3016 30.625 14.5107 30.8341 14.5107 31.0908C14.5106 31.3474 14.3015 31.5557 14.0449 31.5557H12.4814C12.2248 31.5557 12.0157 31.3474 12.0156 31.0908C12.0156 30.8341 12.2247 30.625 12.4814 30.625Z" fill="#3799FF" stroke="#37AFFF" stroke-width="0.633563"/>
<path d="M18.9658 10.604L24.0109 9.288C24.815 9.07834 25.6405 9.56242 25.8505 10.3664L31.2456 31.0493C31.4553 31.8535 30.9714 32.679 30.1672 32.8889L25.1222 34.2049C24.3181 34.4144 23.4924 33.9306 23.2826 33.1265L17.8874 12.4436C17.6779 11.6396 18.1619 10.814 18.9658 10.604Z" fill="#37CAFF" stroke="#37CAFF" stroke-width="0.633563"/>
<path d="M26.1458 27.8008C25.7281 27.9097 25.3007 27.6592 25.1917 27.2415L21.6389 13.6214C21.5299 13.2037 21.7805 12.7763 22.1982 12.6674C22.6159 12.5584 23.0433 12.809 23.1522 13.2267L26.7051 26.8467C26.814 27.2644 26.5634 27.6918 26.1458 27.8008Z" fill="white"/>
<path d="M25.8639 29.8167L27.3767 29.4221C27.6251 29.3573 27.8802 29.5069 27.945 29.7553C28.0097 30.0036 27.8599 30.2579 27.6116 30.3226L26.0988 30.7173C25.8504 30.782 25.5956 30.6333 25.5307 30.385C25.4659 30.1367 25.6155 29.8815 25.8639 29.8167Z" fill="#3799FF" stroke="#37CAFF" stroke-width="0.633563"/>
<path d="M19.8188 4.07527H13.8914C13.5876 4.07527 13.3357 3.82335 13.3357 3.51957C13.3357 3.21578 13.5876 2.96387 13.8914 2.96387H19.8188C20.1226 2.96387 20.3745 3.21578 20.3745 3.51957C20.3745 3.82335 20.1226 4.07527 19.8188 4.07527Z" fill="#3799FF"/>
<path d="M16.8551 7.03886C16.5514 7.03886 16.2994 6.78694 16.2994 6.48316V0.555699C16.2994 0.251917 16.5514 0 16.8551 0C17.1589 0 17.4108 0.251917 17.4108 0.555699V6.48316C17.4108 6.78694 17.1589 7.03886 16.8551 7.03886Z" fill="#3799FF"/>
</svg>


  </i>

  <!-- Tabs slot -->
  <div slot="tabs" class="d-flex justify-content-between w-100">
    <ul class="nav nav-stretch nav-line-tabs nav-line-tabs-2x border-transparent fs-5 fw-semibold flex-nowrap">
      <li class="nav-item">
        <a class="nav-link text-active-primary pb-4"
          [class.active]="activeTab === 'knowledge'"
          (click)="setActiveTab('knowledge')">
          {{ lang === 'ar' ? 'بيانات وتقارير' : 'Data and Reports' }}
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-active-primary pb-4"
          [class.active]="activeTab === 'meeting'"
          (click)="setActiveTab('meeting')">
          {{ lang === 'ar' ? "اجتماعات" : 'Meetings' }}
        </a>
      </li>
    </ul>
  </div>
</app-page-header>

<div class="container-fluid bg-white rounded-lg" style="border-radius: 10px;">
  <!-- Statistics Cards -->
  <div class="row mb-4" *ngIf="canViewSalesTabs">
    <div class="col-12 d-flex justify-content-end">
      <div class="d-flex gap-3" *ngIf="orderStatisticsService.statistics$ | async as stats; else loadingSpinnerHeader">
        <!-- Purchased Card -->
        <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
          <div class="symbol symbol-40px me-2">
            <div class="symbol-label bg-light-primary">
              <i class="ki-outline ki-basket text-primary fs-5"></i>
            </div>
          </div>
          <div class="d-flex flex-column">
            <span class="text-gray-800 fw-bold fs-6">
              <ng-container *ngIf="activeTab === 'knowledge'">
                ${{ stats?.knowledge_purchased_amount || 0 }}
              </ng-container>
              <ng-container *ngIf="activeTab === 'meeting'">
                ${{ stats?.meeting_purchased_amount || 0 }}
              </ng-container>
            </span>
            <span class="text-muted fw-semibold fs-8">
              {{ lang === 'ar' ? 'مشترى' : 'Purchased' }}
            </span>
          </div>
        </div>
      </div>

      <ng-template #loadingSpinnerHeader>
        <div class="d-flex gap-3">
          <!-- Loading Purchased Card -->
          <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
            <div class="symbol symbol-40px me-2">
              <div class="symbol-label bg-light-primary">
                <i class="ki-outline ki-basket text-primary fs-5"></i>
              </div>
            </div>
            <div class="d-flex flex-column">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span class="text-muted fw-semibold fs-8">
                {{ lang === 'ar' ? 'مشترى' : 'Purchased' }}
              </span>
            </div>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Knowledge Orders Tab -->
  <ng-container *ngIf="activeTab === 'knowledge'">
    <app-knowledge-orders
      [lang]="currentLang"
      [orders$]="orders$"
      [totalPages$]="totalPages$"
      [currentPage]="currentPage"
      [isLoading$]="isLoading$"
      (pageChange)="onPageChange($event)"
      (orderSelected)="openOrderDetails($event)"
      (invoiceDownload)="downloadInvoice($event)"
      (navigateToDownloads)="navigateToDownloads($event)"
      (copyOrderNo)="copyOrderNo($event)">
    </app-knowledge-orders>
  </ng-container>

<!-- Meeting Orders Tab -->
  <ng-container *ngIf="activeTab === 'meeting'">
    <app-meeting-orders
      [lang]="currentLang"
      [meetingOrders$]="meetingOrders$"
      [meetingTotalPages$]="meetingTotalPages$"
      [currentMeetingPage]="currentMeetingPage"
      [isMeetingLoading$]="isMeetingLoading$"
      (meetingPageChange)="onMeetingPageChange($event)"
      (meetingOrderSelected)="openMeetingOrderDetails($event)"
      (invoiceDownload)="downloadInvoice($event)"
      (copyOrderNo)="copyOrderNo($event)">
    </app-meeting-orders>
  </ng-container>

<!-- Order Details Dialog -->
<app-order-details-dialog
  [(visible)]="showOrderDetails"
  [lang]="currentLang"
  [order]="selectedOrder">
</app-order-details-dialog>

<!-- Meeting Order Details Dialog -->
<app-meeting-order-details-dialog
  [(visible)]="showMeetingOrderDetails"
  [lang]="currentLang"
  [order]="selectedMeetingOrder">
</app-meeting-order-details-dialog>
