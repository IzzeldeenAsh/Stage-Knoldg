
<!-- Page Header -->
<app-page-header
  [titleEn]="'My Downloads'"
  [titleAr]="'تحميلاتي'"
  [subtitle]="getDownloadsSubtitle()"
  [lang]="lang">
  <div slot="icon">
<svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.7874 21.9676H17.0406C16.7823 21.9676 16.5709 21.7562 16.5709 21.4979V17.0452C16.5709 16.8761 16.4347 16.7399 16.2656 16.7399H14.725C14.5559 16.7399 14.4197 16.8761 14.4197 17.0452V21.4979C14.4197 21.7562 14.2084 21.9676 13.95 21.9676H13.2079C13.0482 21.9676 12.9684 22.0756 12.9449 22.1179C12.9214 22.1602 12.8744 22.2729 12.9355 22.3997L15.1947 25.3118C15.2088 25.3306 15.2182 25.3447 15.2323 25.3635C15.3121 25.4997 15.439 25.5138 15.4953 25.5138C15.547 25.5138 15.6785 25.4997 15.7584 25.3635C15.7677 25.3447 15.7818 25.3259 15.7959 25.3118L18.0599 22.3997C18.1209 22.2729 18.074 22.1649 18.0505 22.1226C18.0223 22.0756 17.9471 21.9676 17.7874 21.9676Z" fill="#0778B9"/>
<path d="M15.5001 14.0298C11.5876 14.0298 8.39832 17.2143 8.39832 21.1316C8.39832 25.0489 11.5876 28.2287 15.5001 28.2287C19.4127 28.2287 22.602 25.0442 22.602 21.1269C22.602 17.2096 19.4174 14.0298 15.5001 14.0298Z" fill="#0778B9"/>
<path d="M26.2043 11.4089C26.1479 11.4089 26.0916 11.4089 26.0352 11.4136C25.9084 11.4183 25.7769 11.3713 25.6876 11.2774C25.5937 11.1835 25.5467 11.0613 25.5467 10.9298L25.5514 10.7842C25.5514 8.39815 23.6116 6.4583 21.2255 6.4583C20.1828 6.4583 19.1776 6.83406 18.3932 7.51512C18.2711 7.61845 18.1067 7.65603 17.9517 7.61375C17.7967 7.56678 17.6793 7.44936 17.6323 7.29436C16.8432 4.63118 14.3538 2.76648 11.5732 2.76648C8.08809 2.76648 5.25582 5.60345 5.25582 9.0886C5.25582 9.31875 5.09142 9.59118 4.86597 9.62875C2.32021 10.0468 0.469604 12.2262 0.469604 14.8095C0.469604 17.7028 2.82279 20.0607 5.72082 20.0607H7.54324C8.0693 16.1341 11.4323 13.0904 15.5046 13.0904C19.5722 13.0904 22.9399 16.1341 23.466 20.0607H26.209C28.5951 20.0607 30.5349 18.1209 30.5349 15.7348C30.5302 13.3488 28.5904 11.4089 26.2043 11.4089Z" fill="#0778B9" fill-opacity="0.5"/>
<path d="M17.2155 21.2031L16.0482 22.3705V18.5091C16.0482 18.3741 15.9946 18.2446 15.8991 18.1491C15.8036 18.0536 15.6741 18 15.5391 18C15.4041 18 15.2746 18.0536 15.1792 18.1491C15.0837 18.2446 15.0301 18.3741 15.0301 18.5091V22.3705L13.8627 21.2032C13.7667 21.1104 13.6381 21.0591 13.5047 21.0603C13.3712 21.0614 13.2435 21.115 13.1491 21.2094C13.0547 21.3038 13.0012 21.4314 13 21.5649C12.9989 21.6984 13.0502 21.827 13.1429 21.923L15.1792 23.9593C15.2265 24.0066 15.2826 24.0441 15.3444 24.0697C15.4061 24.0953 15.4723 24.1084 15.5392 24.1084C15.606 24.1084 15.6722 24.0953 15.7339 24.0697C15.7957 24.0441 15.8518 24.0066 15.8991 23.9593L17.9354 21.923C18.0281 21.827 18.0794 21.6984 18.0783 21.5649C18.0771 21.4314 18.0236 21.3038 17.9292 21.2094C17.8348 21.115 17.7071 21.0614 17.5736 21.0603C17.4402 21.0591 17.3115 21.1104 17.2155 21.2031Z" fill="white"/>
</svg>


  </div>
</app-page-header>

@if (loading()) {
  <div *ngIf="loading" class="text-center py-10 bg-light rounded mb-5 border border-1 border-light">
    <div class="my-5">
        <div class="spinner-border text-primary mb-4" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">{{ 'COMMON.LOADING' | translate }}</span>
        </div>
        <h3 class="fw-bold text-gray-800 mb-2">Loading Downloads</h3>
        <p class="text-gray-600 fs-6 px-3">Please wait while we fetch your downloads...</p>
    </div>
</div>
} @else {

  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col-12">
          
          <!-- Search Bar -->
          <div class="row mb-10">
            <div class="col-12">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1 me-3">
                  <div class="input-group" [class.flex-row-reverse]="lang === 'ar'">
                    <span class="input-group-text bg-light" [class.border-end-0]="lang !== 'ar'" [class.border-start-0]="lang === 'ar'">
                      <i class="ki-duotone ki-magnifier fs-4">
                        <span class="path1"></span>
                        <span class="path2"></span>
                      </i>
                    </span>
                    <input 
                      type="text" 
                      class="form-control"
                      [class.border-start-0]="lang !== 'ar'"
                      [class.border-end-0]="lang === 'ar'"
                      [formControl]="searchControl"
                      [placeholder]="'MY_DOWNLOADS.SEARCH_PLACEHOLDER' | translate"
                      [style.text-align]="lang === 'ar' ? 'right' : 'left'"
                      [style.direction]="lang === 'ar' ? 'rtl' : 'ltr'"
                      autocomplete="off">
                  </div>
                </div>
                @if (currentSearchTerm()) {
                  <button 
                    type="button" 
                    class="btn btn-sm btn-light-danger" 
                    (click)="clearSearch()"
                    [attr.title]="'COMMON.CLEAR_SEARCH' | translate">
                    <i class="ki-duotone ki-cross fs-2">
                      <span class="path1"></span>
                      <span class="path2"></span>
                    </i>
                  </button>
                }
                @if (currentUuids().length > 0) {
                  <button 
                    type="button" 
                    class="btn btn-sm btn-light-primary ms-2" 
                    (click)="viewAll()"
                    [attr.title]="'MY_DOWNLOADS.VIEW_ALL' | translate">
                    <i class="ki-duotone ki-eye fs-2">
                      <span class="path1"></span>
                      <span class="path2"></span>
                      <span class="path3"></span>
                    </i>
                    <span class="ms-1">{{ 'MY_DOWNLOADS.VIEW_ALL' | translate }}</span>
                  </button>
                }
              </div>
            </div>
          </div>

          <!-- Archived Toggle Button Row -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="d-flex justify-content-start">
                <button
                  class="btn btn-sm btn-outline-info d-flex align-items-center toggle-archived-btn"
                  [class.active]="showArchivedDownloads()"
                  (click)="toggleArchivedDownloads()"
                  [pTooltip]="showArchivedDownloads() ? 'Show Downloads' : 'Show Archived'"
                  tooltipPosition="top">
                  @if (showArchivedDownloads()) {
                    <i class="pi pi-arrow-left me-2 text-dark" style="font-size: 1rem;"></i>
                  } @else {
                    <i class="pi pi-inbox me-2 text-dark" style="font-size: 1rem;"></i>
                  }
                  <span>{{ showArchivedDownloads() ? 'Downloads' : 'Archived' }}</span>
                  @if (!showArchivedDownloads() && libraryStatistics()?.archived) {
                    <span class="badge badge-light-info ms-2">{{ libraryStatistics()?.archived }}</span>
                  }
                </button>
              </div>
            </div>
          </div>

                <!-- Three Column Layout -->
                <div class="row" style="min-height: 500px;">
    
                  <!-- Column 1: Knowledge Items -->
                  <div class="col-lg-4 border-end" (click)="onKnowledgeColumnClick()">
                    <div class="d-flex align-items-center gap-2 mb-4 bg-light-gray px-4 py-4">
                      <h5 class="mb-0 fw-bold text-dark">{{ 'MY_DOWNLOADS.KNOWLEDGE_ITEMS' | translate }}</h5>
                      <span class="badge badge-light-info">{{ currentDisplayTotalItems() }}</span>
                    </div>
                    
                    <div 
                      #knowledgeList
                      class="knowledge-list" 
                      style="max-height: 400px; overflow-y: auto;"
                      (scroll)="onKnowledgeListScroll()">
                        @if (currentKnowledgeItems().length === 0) {
                        <div class="text-center py-5">
                          @if (currentSearchTerm()) {
                            <i class="ki-duotone ki-magnifier fs-3x text-muted mb-3">
                              <span class="path1"></span>
                              <span class="path2"></span>
                            </i>
                            <p class="text-muted">{{ 'COMMON.NO_SEARCH_RESULTS' | translate }}</p>
                            <button class="btn btn-sm btn-light-info" (click)="clearSearch()">
                              {{ 'COMMON.CLEAR' | translate }}
                            </button>
                          } @else {
                            <i class="ki-duotone ki-folder-down fs-3x text-muted mb-3">
                              <span class="path1"></span>
                              <span class="path2"></span>
                            </i>
                            <p class="text-muted">{{ 'MY_DOWNLOADS.NO_DOWNLOADS' | translate }}</p>
                          }
                        </div>
                      } @else {
                        @for (knowledge of currentKnowledgeItems(); track trackByKnowledgeUuid($index, knowledge)) {
                          <div 
                            class="knowledge-item d-flex align-items-center px-4 py-2 mb-2 border rounded cursor-pointer"
                            [class.active]="selectedKnowledge()?.uuid === knowledge.uuid"
                            (click)="selectKnowledge(knowledge); $event.stopPropagation()">
                            
                            <!-- Folder Icon -->
                            <div class="me-3">
                              <i class="ki-duotone ki-folder fs-4 text-info">
                                <span class="path1"></span>
                                <span class="path2"></span>
                              </i>
                            </div>
                            
                            <!-- Knowledge Title -->
                            <div class="flex-grow-1">
                              <div class=" fs-7 fw-bold">{{ knowledge.title | truncateText: 30 }}</div>
                              <div class="d-flex align-items-center gap-1">
                            
                                <small class="text-muted fs-8">{{ knowledge.type | titlecase }}</small>
                              </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="ms-2 d-flex gap-1">
                              <!-- Download Button -->
                              <button
                                class="btn btn-xs btn-light-info download-btn "
                                (click)="downloadKnowledge(knowledge); $event.stopPropagation()"
                                [disabled]="isKnowledgeDownloading(knowledge.uuid)"
                                [pTooltip]="'Download Knowledge'"
                                style="border-color: transparent !important"
                                tooltipPosition="top">
                                @if (isKnowledgeDownloading(knowledge.uuid)) {
                                  <span class="spinner-border spinner-border-sm" role="status"></span>
                                } @else {
                                  <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14.8381 6.55927C14.7248 5.29546 14.1891 4.10666 13.3175 3.18454C12.4459 2.26242 11.2891 1.66073 10.0337 1.47648C8.77823 1.29224 7.49733 1.53618 6.3975 2.16898C5.29768 2.80177 4.44302 3.78654 3.97134 4.96449C3.94609 4.96397 3.92115 4.9583 3.89585 4.9583C2.92105 4.95841 1.98169 5.32392 1.26318 5.98269C0.544667 6.64147 0.099194 7.54564 0.0146792 8.51678C-0.0698356 9.48791 0.212748 10.4554 0.80666 11.2284C1.40057 12.0014 2.26266 12.5237 3.22279 12.6922C3.24314 12.6957 3.26373 12.6974 3.28436 12.6974C3.3729 12.6971 3.45814 12.6637 3.52328 12.6038C3.58841 12.5438 3.62873 12.4616 3.63628 12.3734C3.64384 12.2852 3.61808 12.1973 3.56409 12.1271C3.51009 12.057 3.43178 12.0096 3.34457 11.9943C2.5591 11.8562 1.85389 11.4288 1.3681 10.7964C0.882311 10.1639 0.651224 9.3723 0.720443 8.57781C0.789662 7.78331 1.15416 7.04362 1.742 6.50469C2.32985 5.96576 3.09835 5.66674 3.89585 5.66663C4.58544 5.66972 5.25593 5.89346 5.80918 6.30511C5.88461 6.36086 5.97906 6.38445 6.07184 6.3707C6.16462 6.35695 6.24817 6.30699 6.30419 6.23175C6.3602 6.15652 6.38411 6.06215 6.37068 5.96932C6.35725 5.87649 6.30757 5.79277 6.23252 5.7365C5.77723 5.40302 5.25586 5.17082 4.70341 5.05549C5.14081 4.07333 5.88666 3.26066 6.82778 2.74081C7.7689 2.22095 8.85392 2.02228 9.91818 2.17496C10.9824 2.32763 11.9678 2.82331 12.7249 3.58677C13.4819 4.35023 13.9692 5.3398 14.1129 6.40532C14.0124 6.39576 13.9154 6.37497 13.8125 6.37497C13.7186 6.37497 13.6285 6.41228 13.5621 6.4787C13.4957 6.54512 13.4584 6.6352 13.4584 6.72914C13.4584 6.82307 13.4957 6.91315 13.5621 6.97957C13.6285 7.04599 13.7186 7.0833 13.8125 7.0833C14.47 7.0833 15.1006 7.3445 15.5656 7.80943C16.0305 8.27437 16.2917 8.90495 16.2917 9.56247C16.2917 10.22 16.0305 10.8506 15.5656 11.3155C15.1006 11.7804 14.47 12.0416 13.8125 12.0416H13.706C13.6121 12.0416 13.522 12.0789 13.4556 12.1454C13.3891 12.2118 13.3518 12.3019 13.3518 12.3958C13.3518 12.4897 13.3891 12.5798 13.4556 12.6462C13.522 12.7127 13.6121 12.75 13.706 12.75H13.8125C14.567 12.752 15.2976 12.4856 15.8738 11.9984C16.4499 11.5112 16.834 10.835 16.9573 10.0907C17.0806 9.3463 16.9351 8.58235 16.5469 7.93539C16.1587 7.28843 15.553 6.80066 14.8381 6.55927Z" fill="currentColor"/>
                                    <path d="M9.66624 11.4372L8.85415 12.2493V9.56291C8.85415 9.46898 8.81684 9.37889 8.75042 9.31247C8.684 9.24605 8.59392 9.20874 8.49999 9.20874C8.40606 9.20874 8.31597 9.24605 8.24955 9.31247C8.18313 9.37889 8.14582 9.46898 8.14582 9.56291V12.2493L7.33373 11.4372C7.26693 11.3727 7.17747 11.337 7.08461 11.3378C6.99175 11.3386 6.90292 11.3758 6.83725 11.4415C6.77159 11.5072 6.73434 11.596 6.73353 11.6888C6.73273 11.7817 6.76842 11.8712 6.83294 11.938L8.24961 13.3546C8.28248 13.3875 8.32152 13.4136 8.36448 13.4314C8.40745 13.4492 8.4535 13.4584 8.5 13.4584C8.54651 13.4584 8.59256 13.4492 8.63552 13.4314C8.67848 13.4136 8.71752 13.3875 8.7504 13.3546L10.1671 11.938C10.2316 11.8712 10.2673 11.7817 10.2665 11.6888C10.2657 11.596 10.2284 11.5072 10.1628 11.4415C10.0971 11.3758 10.0083 11.3386 9.91539 11.3378C9.82253 11.337 9.73304 11.3726 9.66624 11.4372Z" fill="currentColor"/>
                                    <path d="M8.5 7.08337C7.65943 7.08337 6.83774 7.33263 6.13883 7.79963C5.43992 8.26662 4.89519 8.93038 4.57351 9.70697C4.25184 10.4836 4.16768 11.3381 4.33166 12.1625C4.49565 12.9869 4.90043 13.7442 5.4948 14.3386C6.08917 14.933 6.84645 15.3377 7.67087 15.5017C8.49529 15.6657 9.34982 15.5815 10.1264 15.2599C10.903 14.9382 11.5668 14.3935 12.0337 13.6945C12.5007 12.9956 12.75 12.1739 12.75 11.3334C12.7488 10.2066 12.3006 9.12629 11.5038 8.32953C10.7071 7.53277 9.62679 7.08461 8.5 7.08337ZM8.5 14.875C7.79953 14.875 7.11478 14.6673 6.53236 14.2782C5.94993 13.889 5.49599 13.3359 5.22793 12.6887C4.95987 12.0416 4.88973 11.3294 5.02639 10.6424C5.16304 9.95541 5.50035 9.32435 5.99567 8.82904C6.49098 8.33373 7.12204 7.99642 7.80906 7.85976C8.49607 7.7231 9.20818 7.79324 9.85534 8.0613C10.5025 8.32936 11.0556 8.78331 11.4448 9.36573C11.834 9.94815 12.0417 10.6329 12.0417 11.3334C12.0406 12.2723 11.6671 13.1725 11.0031 13.8365C10.3392 14.5004 9.43897 14.8739 8.5 14.875Z" fill="currentColor"/>
                                  </svg>
                                }
                              </button>

                              <!-- Archive Button - only show when not viewing archived items -->
                              @if (!showArchivedDownloads()) {
                                <button
                                  class="btn btn-xs btn-light-warning archive-btn"
                                  (click)="archiveKnowledge(knowledge); $event.stopPropagation()"
                                  [disabled]="isKnowledgeDownloading(knowledge.uuid)"
                                  [pTooltip]="'Archive Knowledge'"
                                  tooltipPosition="top">
                                  <i class="pi pi-inbox text-warning" style="font-size: 1rem; padding: 0;"></i>
                                </button>
                              }
                            </div>
                          </div>
                        }
                      }
                    </div>
                    
                    <!-- Scroll Controls -->
                    <div class="d-flex justify-content-center mt-3">
                      @if (showScrollButton() === 'up') {
                        <button 
                          class="scroll-button"
                          (click)="scrollUp(); $event.stopPropagation()"
                          [attr.title]="'Scroll Up'">
                          <i class="ki-duotone ki-up fs-4">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                        </button>
                      }
                      
                      @if (showScrollButton() === 'down') {
                        <button 
                          class="scroll-button"
                          (click)="scrollDown(); $event.stopPropagation()"
                          [attr.title]="'Scroll Down'">
                          <i class="ki-duotone ki-down fs-4">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                        </button>
                      }
                    </div>
                    
                    <!-- Pagination -->
                    @if (currentDisplayTotalPages() > 1) {
                      <div class="d-flex justify-content-center mt-4">
                        <ul class="pagination pagination-sm">
                          <li class="page-item" [class.disabled]="!hasPrevPage()">
                            <a class="page-link" (click)="onPageChange(currentDisplayPage() - 1)">
                              <i class="previous"></i>
                            </a>
                          </li>

                          @for (page of getPages(); track trackByPageIndex($index, page)) {
                            <li class="page-item"
                                [class.active]="page === currentDisplayPage()"
                                [class.disabled]="page === '...'">
                              <a class="page-link" (click)="onPageClick(page)">{{ page }}</a>
                            </li>
                          }

                          <li class="page-item" [class.disabled]="!hasNextPage()">
                            <a class="page-link" (click)="onPageChange(currentDisplayPage() + 1)">
                              <i class="next"></i>
                            </a>
                          </li>
                        </ul>
                      </div>
                    }
                  </div>
    
                  <!-- Column 2: Documents -->
                  <div class="col-lg-4 border-end">
                    <div class="d-flex align-items-center mb-4 bg-light-gray p-4">
                      <h5 class="mb-0 fw-bold text-dark">{{ 'MY_DOWNLOADS.DOCUMENTS' | translate }}</h5>
                      @if (selectedKnowledge()) {
                        <span class="badge badge-light-success ms-2">{{ currentKnowledgeDocuments().length }}</span>
                      }
                    </div>
                    
                    <div class="documents-list" style="max-height: 400px; overflow-y: auto;">
                      @if (!selectedKnowledge()) {
                        <!-- <div class="text-center py-5">
                          <i class="ki-duotone ki-document fs-3x text-muted mb-3">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                          <p class="text-muted">{{ 'MY_DOWNLOADS.SELECT_KNOWLEDGE' | translate }}</p>
                        </div> -->
                      } @else if (currentKnowledgeDocuments().length === 0) {
                        <div class="text-center py-5">
                          <i class="ki-duotone ki-document fs-3x text-muted mb-3">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                          <p class="text-muted">{{ 'MY_DOWNLOADS.NO_DOCUMENTS' | translate }}</p>
                        </div>
                      } @else {
                        @for (document of currentKnowledgeDocuments(); track trackByDocumentUuid($index, document)) {
                          <div 
                            class="document-item d-flex align-items-center px-4 py-2 mb-2 border rounded cursor-pointer"
                            [class.active]="selectedDocument()?.uuid === document.uuid"
                            (click)="selectDocument(document)">
                            
                            <!-- Document Icon -->
                            <div class="me-3">
                              <img
                                [src]="getFileIconByExtension(document.file_extension)"
                                [alt]="document.file_extension + ' file'"
                                width="32"
                                height="32"
                                class="file-icon"/>
                            </div>
                            
                            <!-- Document Name -->
                            <div class="flex-grow-1">
                              <div class=" fs-7 fw-bold">{{ document.file_name | truncateText: 30 }}</div>
                              <div class="d-flex align-items-center gap-2">
                                <small class="text-muted fs-8">{{ document.file_size | fileSize }}</small>
                                <span class="text-muted">•</span>
                                @if (document.price > 0) {
                                  <small class="text-muted fs-8">${{ document.price }}</small>
                                } @else {
                                  <small class="text-success fs-8">{{ 'COMMON.FREE' | translate }}</small>
                                }
                              </div>
                            </div>
                            
                            <!-- Download Icon -->
                            <div class="ms-2">
                              <button
                                class="btn btn-xs btn-light-info download-btn"
                                (click)="downloadDocument(document); $event.stopPropagation()"
                                [disabled]="isDocumentDownloading(document.uuid)"
                                [pTooltip]="'Download Document'"
                                style="border-color: transparent !important"
                                tooltipPosition="top">
                                @if (isDocumentDownloading(document.uuid)) {
                                  <span class="spinner-border spinner-border-sm" role="status"></span>
                                } @else {
                                  <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14.8381 6.55927C14.7248 5.29546 14.1891 4.10666 13.3175 3.18454C12.4459 2.26242 11.2891 1.66073 10.0337 1.47648C8.77823 1.29224 7.49733 1.53618 6.3975 2.16898C5.29768 2.80177 4.44302 3.78654 3.97134 4.96449C3.94609 4.96397 3.92115 4.9583 3.89585 4.9583C2.92105 4.95841 1.98169 5.32392 1.26318 5.98269C0.544667 6.64147 0.099194 7.54564 0.0146792 8.51678C-0.0698356 9.48791 0.212748 10.4554 0.80666 11.2284C1.40057 12.0014 2.26266 12.5237 3.22279 12.6922C3.24314 12.6957 3.26373 12.6974 3.28436 12.6974C3.3729 12.6971 3.45814 12.6637 3.52328 12.6038C3.58841 12.5438 3.62873 12.4616 3.63628 12.3734C3.64384 12.2852 3.61808 12.1973 3.56409 12.1271C3.51009 12.057 3.43178 12.0096 3.34457 11.9943C2.5591 11.8562 1.85389 11.4288 1.3681 10.7964C0.882311 10.1639 0.651224 9.3723 0.720443 8.57781C0.789662 7.78331 1.15416 7.04362 1.742 6.50469C2.32985 5.96576 3.09835 5.66674 3.89585 5.66663C4.58544 5.66972 5.25593 5.89346 5.80918 6.30511C5.88461 6.36086 5.97906 6.38445 6.07184 6.3707C6.16462 6.35695 6.24817 6.30699 6.30419 6.23175C6.3602 6.15652 6.38411 6.06215 6.37068 5.96932C6.35725 5.87649 6.30757 5.79277 6.23252 5.7365C5.77723 5.40302 5.25586 5.17082 4.70341 5.05549C5.14081 4.07333 5.88666 3.26066 6.82778 2.74081C7.7689 2.22095 8.85392 2.02228 9.91818 2.17496C10.9824 2.32763 11.9678 2.82331 12.7249 3.58677C13.4819 4.35023 13.9692 5.3398 14.1129 6.40532C14.0124 6.39576 13.9154 6.37497 13.8125 6.37497C13.7186 6.37497 13.6285 6.41228 13.5621 6.4787C13.4957 6.54512 13.4584 6.6352 13.4584 6.72914C13.4584 6.82307 13.4957 6.91315 13.5621 6.97957C13.6285 7.04599 13.7186 7.0833 13.8125 7.0833C14.47 7.0833 15.1006 7.3445 15.5656 7.80943C16.0305 8.27437 16.2917 8.90495 16.2917 9.56247C16.2917 10.22 16.0305 10.8506 15.5656 11.3155C15.1006 11.7804 14.47 12.0416 13.8125 12.0416H13.706C13.6121 12.0416 13.522 12.0789 13.4556 12.1454C13.3891 12.2118 13.3518 12.3019 13.3518 12.3958C13.3518 12.4897 13.3891 12.5798 13.4556 12.6462C13.522 12.7127 13.6121 12.75 13.706 12.75H13.8125C14.567 12.752 15.2976 12.4856 15.8738 11.9984C16.4499 11.5112 16.834 10.835 16.9573 10.0907C17.0806 9.3463 16.9351 8.58235 16.5469 7.93539C16.1587 7.28843 15.553 6.80066 14.8381 6.55927Z" fill="currentColor"/>
                                    <path d="M9.66624 11.4372L8.85415 12.2493V9.56291C8.85415 9.46898 8.81684 9.37889 8.75042 9.31247C8.684 9.24605 8.59392 9.20874 8.49999 9.20874C8.40606 9.20874 8.31597 9.24605 8.24955 9.31247C8.18313 9.37889 8.14582 9.46898 8.14582 9.56291V12.2493L7.33373 11.4372C7.26693 11.3727 7.17747 11.337 7.08461 11.3378C6.99175 11.3386 6.90292 11.3758 6.83725 11.4415C6.77159 11.5072 6.73434 11.596 6.73353 11.6888C6.73273 11.7817 6.76842 11.8712 6.83294 11.938L8.24961 13.3546C8.28248 13.3875 8.32152 13.4136 8.36448 13.4314C8.40745 13.4492 8.4535 13.4584 8.5 13.4584C8.54651 13.4584 8.59256 13.4492 8.63552 13.4314C8.67848 13.4136 8.71752 13.3875 8.7504 13.3546L10.1671 11.938C10.2316 11.8712 10.2673 11.7817 10.2665 11.6888C10.2657 11.596 10.2284 11.5072 10.1628 11.4415C10.0971 11.3758 10.0083 11.3386 9.91539 11.3378C9.82253 11.337 9.73304 11.3726 9.66624 11.4372Z" fill="currentColor"/>
                                    <path d="M8.5 7.08337C7.65943 7.08337 6.83774 7.33263 6.13883 7.79963C5.43992 8.26662 4.89519 8.93038 4.57351 9.70697C4.25184 10.4836 4.16768 11.3381 4.33166 12.1625C4.49565 12.9869 4.90043 13.7442 5.4948 14.3386C6.08917 14.933 6.84645 15.3377 7.67087 15.5017C8.49529 15.6657 9.34982 15.5815 10.1264 15.2599C10.903 14.9382 11.5668 14.3935 12.0337 13.6945C12.5007 12.9956 12.75 12.1739 12.75 11.3334C12.7488 10.2066 12.3006 9.12629 11.5038 8.32953C10.7071 7.53277 9.62679 7.08461 8.5 7.08337ZM8.5 14.875C7.79953 14.875 7.11478 14.6673 6.53236 14.2782C5.94993 13.889 5.49599 13.3359 5.22793 12.6887C4.95987 12.0416 4.88973 11.3294 5.02639 10.6424C5.16304 9.95541 5.50035 9.32435 5.99567 8.82904C6.49098 8.33373 7.12204 7.99642 7.80906 7.85976C8.49607 7.7231 9.20818 7.79324 9.85534 8.0613C10.5025 8.32936 11.0556 8.78331 11.4448 9.36573C11.834 9.94815 12.0417 10.6329 12.0417 11.3334C12.0406 12.2723 11.6671 13.1725 11.0031 13.8365C10.3392 14.5004 9.43897 14.8739 8.5 14.875Z" fill="currentColor"/>
                                  </svg>
                                }
                              </button>
                            </div>
                          </div>
                        }
                      }
                    </div>
                  </div>
    
                  <!-- Column 3: Details -->
                  <div class="col-lg-4">
                    <div class="d-flex align-items-center gap-2 mb-4 bg-light-gray p-4">
                      <h5 class="mb-0 fw-bold text-dark">{{ 'MY_DOWNLOADS.KNOWLEDGE_SOURCE' | translate }}</h5>
                    </div>
                    <div class="details-panel">
                      @if (!selectedKnowledge()) {
                        <!-- <div class="text-center py-5">
                          <i class="ki-duotone ki-information fs-3x text-muted mb-3">
                            <span class="path1"></span>
                            <span class="path2"></span>
                            <span class="path3"></span>
                          </i>
                          <p class="text-muted">{{ 'MY_DOWNLOADS.SELECT_ITEM_DETAILS' | translate }}</p>
                        </div> -->
                      } @else {
                        <!-- Background section with type and title -->
                        <div class="details-header">
                          @if (currentKnowledgeDetails(); as details) {
                            <div class="d-flex align-items-center  gap-2 mb-2">
                              @switch (details.type) {
                                @case ('data') {
                                  <svg width="18" height="18" viewBox="0 0 30 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14.5464 0C10.5851 0 6.86364 0.704566 4.06815 1.98373C1.48292 3.16777 0 4.73376 0 6.28348C0 7.8332 1.48292 9.39967 4.06815 10.5831C6.86364 11.8623 10.585 12.5669 14.5464 12.5669C18.5078 12.5669 22.2297 11.8623 25.0243 10.5831C27.6099 9.39967 29.0933 7.8333 29.0933 6.28348C29.0933 4.73367 27.6099 3.16777 25.0243 1.98373C22.2293 0.704566 18.5077 0 14.5464 0Z" fill="#0179FE"/>
                                    <path d="M0 9.45442C0.821516 10.3442 1.99713 11.1499 3.49489 11.8359C6.46628 13.1954 10.3914 13.9444 14.5469 13.9444C18.7023 13.9444 22.627 13.1949 25.5984 11.8359C27.0961 11.1499 28.2718 10.3445 29.0933 9.45442V13.4496C29.0933 15.004 27.6131 16.5723 25.0331 17.7531C22.2436 19.029 18.5194 19.7326 14.5464 19.7326C10.5734 19.7326 6.84871 19.029 4.05982 17.7531C1.47967 16.5723 0 15.004 0 13.4496V9.45442Z" fill="#0179FE"/>
                                    <path d="M29.0933 16.6207C26.6302 19.2908 21.1116 21.1102 14.5464 21.1102C7.98116 21.1102 2.46273 19.2908 0 16.6207V20.1383C0 21.6918 1.47967 23.261 4.05982 24.4417C6.84871 25.7181 10.5734 26.4217 14.5464 26.4217C18.5194 26.4217 22.2436 25.7181 25.0336 24.4417C27.6136 23.261 29.0933 21.6918 29.0933 20.1383V16.6207Z" fill="#0179FE"/>
                                    <path d="M4.05982 31.608C1.47967 30.4272 0 28.858 0 27.3041V23.3093C2.46273 25.9799 7.98116 27.7994 14.5464 27.7994C21.1116 27.7994 26.6302 25.9799 29.0933 23.3093V27.3041C29.0933 28.858 27.6131 30.4272 25.0331 31.608C22.2436 32.8844 18.5194 33.5875 14.5464 33.5875C10.5734 33.5875 6.84871 32.8844 4.05982 31.608Z" fill="#0179FE"/>
                                  </svg>
                                }
                                @case ('insight') {
                                  <svg width="18" height="18" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M29.5625 0C37.1458 0 41.6663 4.52116 41.6455 12.1045V29.5625C41.6455 37.1457 37.1251 41.6669 29.542 41.667H12.1045C4.52127 41.667 0.00012927 37.146 0 29.542V12.1045C0 4.52116 4.52116 0 12.1045 0H29.5625ZM11.9346 21.46C10.7753 21.4601 9.83305 22.4022 9.83301 23.5615V29.4678C9.83321 30.6269 10.7754 31.5682 11.9346 31.5684C13.112 31.5684 14.0545 30.627 14.0547 29.4678V23.5615C14.0546 22.4021 13.1121 21.46 11.9346 21.46ZM19.96 12.1846C18.7825 12.1847 17.8409 13.1268 17.8408 14.2861V29.4678C17.841 30.6269 18.7827 31.5682 19.96 31.5684C21.1192 31.5684 22.0613 30.627 22.0615 29.4678V14.2861C22.0615 13.1267 21.1194 12.1846 19.96 12.1846ZM27.6689 8.83301C26.4561 8.83301 25.4854 9.93196 25.4854 11.2842V28.9912C25.4855 30.3434 26.4561 31.4424 27.6689 31.4424C28.863 31.4423 29.8329 30.3433 29.833 28.9912V11.2842C29.8329 9.93204 28.8631 8.83313 27.6689 8.83301Z" fill="#0179FE"/>
                                  </svg>
                                }
                                @case ('report') {
                                  <svg width="18" height="18" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path opacity="0.4" d="M45.125 21.75L43.0833 30.4583C41.3333 37.9792 37.875 41.0208 31.375 40.3958C30.3333 40.3125 29.2083 40.125 28 39.8333L24.5 39C15.8125 36.9375 13.125 32.6458 15.1667 23.9375L17.2083 15.2083C17.625 13.4375 18.125 11.8958 18.75 10.625C21.1875 5.58333 25.3333 4.22916 32.2917 5.875L35.7708 6.6875C44.5 8.72916 47.1667 13.0417 45.125 21.75Z" fill="#0179FE"/>
                                    <path d="M31.375 40.3958C30.0833 41.2708 28.4583 42 26.4792 42.6458L23.1875 43.7292C14.9167 46.3958 10.5625 44.1667 7.87499 35.8958L5.20833 27.6667C2.54166 19.3958 4.74999 15.0208 13.0208 12.3542L16.3125 11.2708C17.1667 11 17.9792 10.7708 18.75 10.625C18.125 11.8958 17.625 13.4375 17.2083 15.2083L15.1667 23.9375C13.125 32.6458 15.8125 36.9375 24.5 39L28 39.8333C29.2083 40.125 30.3333 40.3125 31.375 40.3958Z" fill="#0179FE"/>
                                  </svg>
                                }
                                @case ('manual') {
                                  <svg width="18" height="18" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M42.7083 14.5834V31.25H13.2292C9.95834 31.25 7.29167 33.9167 7.29167 37.1875V14.5834C7.29167 6.25002 9.37501 4.16669 17.7083 4.16669H32.2917C40.625 4.16669 42.7083 6.25002 42.7083 14.5834Z" fill="#0179FE"/>
                                    <path d="M42.7083 31.25V38.5417C42.7083 42.5625 39.4375 45.8333 35.4167 45.8333H14.5833C10.5625 45.8333 7.29167 42.5625 7.29167 38.5417V37.1875C7.29167 33.9167 9.95834 31.25 13.2292 31.25H42.7083Z" fill="#0179FE"/>
                                    <path d="M33.3333 16.1458H16.6667C15.8125 16.1458 15.1042 15.4375 15.1042 14.5833C15.1042 13.7291 15.8125 13.0208 16.6667 13.0208H33.3333C34.1875 13.0208 34.8958 13.7291 34.8958 14.5833C34.8958 15.4375 34.1875 16.1458 33.3333 16.1458Z" fill="white"/>
                                    <path d="M27.0833 23.4375H16.6667C15.8125 23.4375 15.1042 22.7292 15.1042 21.875C15.1042 21.0208 15.8125 20.3125 16.6667 20.3125H27.0833C27.9375 20.3125 28.6458 21.0208 28.6458 21.875C28.6458 22.7292 27.9375 23.4375 27.0833 23.4375Z" fill="white"/>
                                  </svg>
                                }
                                @case ('course') {
                                  <svg width="18" height="18" viewBox="0 0 39 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M31.9898 26.8163C31.9898 24.1788 29.8518 22.0408 27.2143 22.0408C24.5767 22.0408 22.4388 24.1788 22.4388 26.8163C22.4388 28.1696 23.0037 29.3885 23.9081 30.2576V36L27.2143 33.7959L30.5204 36V30.2576C31.4248 29.3885 31.9898 28.1696 31.9898 26.8163Z" fill="#0179FE"/>
                                    <path d="M37.1327 0H1.86734C1.05624 0 0.397949 0.657551 0.397949 1.46939V30.8572C0.397949 31.6683 1.05624 32.3265 1.86734 32.3265H20.9694V31.3443C20.0143 30.0372 19.5 28.4694 19.5 26.8163C19.5 22.5625 22.9604 19.102 27.2143 19.102C31.4682 19.102 34.9286 22.5625 34.9286 26.8163C34.9286 28.4701 34.4143 30.038 33.4592 31.345V32.3265H37.1327C37.9438 32.3265 38.6021 31.6683 38.6021 30.8572V1.46939C38.6021 0.657551 37.9438 0 37.1327 0ZM20.9694 13.2245H8.47959V10.2857H20.9694V13.2245ZM30.5204 7.34694H8.47959V4.40816H30.5204V7.34694Z" fill="#0179FE"/>
                                  </svg>
                                }
                                @case ('media') {
                                  <svg width="18" height="18" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M25 0C11.215 0 0 11.215 0 25C0 38.785 11.215 50 25 50C38.785 50 50 38.785 50 25C50 11.215 38.785 0 25 0Z" fill="#0179FE"/>
                                    <path d="M33 25L21 33V17L33 25Z" fill="white"/>
                                  </svg>
                                }
                                @default {
                                  <i class="ki-duotone ki-document fs-5" style="color: #0179FE;"><span class="path1"></span><span class="path2"></span></i>
                                }
                              }
                              <div class="type-label">{{ details.type | uppercase }}</div>
                            </div>
                            <a (click)="viewKnowledge(selectedKnowledge()!); $event.stopPropagation()" class="cursor-pointer">
                            <h2 class="knowledge-title">{{ (selectedKnowledge()?.title || '') | truncateText:40 }}</h2>
                          </a>
                          }
                        </div>
    
                        <!-- White content area -->
                        <div class="details-content">
                          @if (currentKnowledgeDetails(); as details) {
                            <div class="publisher-info">
                              <div class="publisher-content">
                                <!-- Profile/Company Image Container -->
                                <div class="publisher-image-container">
                                  @if (selectedKnowledge()?.company) {
                                    <!-- Company logo with insighter photo overlay -->
                                    <div class="company-logo-container">
                                      <img 
                                        [src]="selectedKnowledge()?.company?.logo" 
                                        [alt]="selectedKnowledge()?.company?.legal_name"
                                        class="company-logo rounded-circle"
                                        style="object-fit: cover; object-position: top;"
                                        onerror="this.src='assets/images/default-company.png'">
                                      @if (selectedKnowledge()?.insighter_photo) {
                                        <img 
                                          [src]="selectedKnowledge()?.insighter_photo" 
                                          [alt]="selectedKnowledge()?.insighter"
                                          class="insighter-overlay"
                                          style="object-fit: cover; object-position: top;"
                                          onerror="this.src='assets/images/default-avatar.png'">
                                      }
                                    </div>
                                  } @else if (selectedKnowledge()?.insighter_photo) {
                                    <!-- Only insighter photo -->
                                    <img 
                                      [src]="selectedKnowledge()?.insighter_photo" 
                                      [alt]="selectedKnowledge()?.insighter"
                                      class="insighter-photo"
                                      style="object-fit: cover; object-position: top;"
                                      onerror="this.src='assets/images/default-avatar.png'">
                                  }
                                </div>
                                
                                <!-- Publisher Name and Company Info -->
                                <div class="publisher-text">
                                  @if (selectedKnowledge()?.company) {
                                    <div class="company-info">
                                      <div class="company-name fw-bold">{{ selectedKnowledge()?.company?.legal_name }}</div>
                                      <span class="text-muted fs-8">By {{ details.publisher }}</span>
                                    </div>
                                  } @else {
                                    <div class="publisher-name fw-bold">{{ details.publisher }}</div>
                                  }
                                </div>
                              </div>
                            </div>
                            
                            <div class="purchase-info">
                              <div class="purchase-date">
                                <span class="label">{{ 'MY_DOWNLOADS.PURCHASE_DATE' | translate }}</span>
                                <span class="value">{{ details.purchaseDate | date:'yyyy/MM/dd' }}</span>
                              </div>
                            </div>
                          }
                        </div>
                      }
                    </div>
                  </div>
    
                </div>
              
        </div>
      </div>
    </div>
    </div>
}
